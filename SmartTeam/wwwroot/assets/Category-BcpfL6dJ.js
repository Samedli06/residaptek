import{aH as D,aI as O,r as n,j as e,y as b,aJ as U,c as F,m as L,k as q,aK as M,N as K}from"./index-BBhEgxr5.js";import{M as S}from"./Modal-GV133dSV.js";import{U as P}from"./upload-BU2oQTXe.js";import{T as _}from"./trash-2-B6-bQTRC.js";import{L as I}from"./loader-circle-Bn7_-Q9n.js";import{C as E}from"./chevron-down-5LTC5Sp0.js";const R=({setOpen:i,categories:m})=>{const[C,{isLoading:x}]=D(),[d,{isLoading:w}]=O(),[j,g]=n.useState(null),[o,c]=n.useState(null),[f,y]=n.useState(null),[h,s]=n.useState({name:"",description:"description",imageUrl:"",sortOrder:1,...j?{parentCategoryId:j}:{}}),v=a=>{const r=a.target.files[0];r&&(c(r),a.target.value="")};n.useEffect(()=>{if(o){const a=URL.createObjectURL(o);return y(a),()=>{URL.revokeObjectURL(a)}}else y(null)},[o]);const u=async a=>{if(a.preventDefault(),!o){b.error("Zəhmət olmasa əvvəlcə şəkil yükləyin");return}try{const r={name:h.name,description:"description",sortOrder:1,...j?{parentCategoryId:j}:{}},t=new FormData;t.append("categoryData",JSON.stringify(r)),t.append("imageFile",o,o.name);const l=await d(t).unwrap();b.success("Kateqoriya uğurla əlavə edildi"),s({name:"",imgUrl:""}),c(null),i()}catch(r){b.error(r?.data||"Nəsə səhv getdi")}},N=a=>{const{name:r,value:t}=a.target;s({...h,[r]:t})};return e.jsxs("form",{onSubmit:u,className:"flex flex-col gap-6 p-6 bg-[#1f1f1f] rounded-lg w-96",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-white text-sm mb-1",htmlFor:"name",children:["Ad ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"name",onChange:N,name:"name",type:"text",required:!0,placeholder:"Kateqoriya adını daxil edin",className:"w-full px-4 py-3 rounded-lg bg-[#2a2a2a] text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-white placeholder:text-gray-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Kateqoriya *"}),e.jsxs("select",{name:"categoryId",onChange:a=>g(a.target.value),className:"w-full px-3 py-2 bg-[#2c2c2c] border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Ana kateqoriya yoxdur"}),m?.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Məhsul şəkilləri"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:v,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer flex flex-col items-center gap-2",children:[e.jsx(P,{className:"w-8 h-8 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Şəkil yükləmək üçün klik edin və ya sürükləyin"}),e.jsx("span",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF up to 10MB each"})]})]}),o&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:f,className:"w-full h-24 object-cover rounded-md border "}),e.jsx("button",{type:"button",onClick:()=>{c(null)},className:"absolute top-1 right-1 bg-red-600 hover:bg-red-700 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(_,{className:"w-3 h-3"})})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:x,className:"px-6 py-3 bg-white text-black font-semibold rounded-lg hover:bg-gray-200 transition-all",children:x?e.jsx(I,{className:"w-12 h-12 text-white animate-spin"}):"Yadda saxla"})})]})},G=({item:i,setOpen:m,categories:C})=>{const[x,d]=n.useState(!1),[w,{isLoading:j}]=U(),[g,o]=n.useState(null),[c,f]=n.useState(null);console.log(c);const[y,h]=n.useState(!1),[s,v]=n.useState({name:"",description:"",slug:"",sortOrder:0,isActive:!0,parentCategoryId:""});n.useEffect(()=>{i&&(v({name:i.name||"",description:i.description||"",slug:i.slug||"",sortOrder:i.sortOrder||0,isActive:i.isActive!==void 0?i.isActive:!0,parentCategoryId:i.parentCategoryId||""}),i.imageUrl?(f(i.imageUrl),h(!1)):(f(null),o(null),h(!1)))},[i]);const u=t=>{const l=t.target.files?.[0];if(!l)return;if(!l.type.startsWith("image/")){alert("Please select a valid image file");return}if(l.size>5*1024*1024){alert("Image size should be less than 5MB");return}o(l),h(!0);const p=new FileReader;p.onloadend=()=>{f(p.result)},p.onerror=k=>{alert("Error reading file")},p.readAsDataURL(l)},N=async t=>{t.preventDefault();try{d(!0);const l=new FormData,p={name:s.name,description:s.description||"description",slug:s.slug,sortOrder:Number(s.sortOrder),isActive:s.isActive,parentCategoryId:s.parentCategoryId||null};l.append("categoryData",JSON.stringify(p)),g&&l.append("imageFile",g);const k=await w({id:i.id,formData:l}).unwrap();b.success("Kateqoriya uğurla yeniləndi"),d(!1),m&&m()}catch(l){b.error(l?.data?.message||"Kateqoriyanı yeniləmək uğursuz oldu"),d(!1)}},a=t=>{const{name:l,value:p,type:k,checked:A}=t.target;v({...s,[l]:k==="checkbox"?A:p})},r=()=>y?c:c?`${F}/${c}`:null;return e.jsxs("form",{onSubmit:N,className:"flex flex-col gap-6 p-6 bg-[#1f1f1f] rounded-lg w-[500px] max-w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-white text-sm mb-1",htmlFor:"name",children:["Ad ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"name",onChange:a,name:"name",type:"text",required:!0,value:s.name,className:"w-full px-4 py-3 rounded-lg bg-[#2a2a2a] text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-white placeholder:text-gray-400"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-white text-sm mb-1",htmlFor:"slug",children:["Slug ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"slug",onChange:a,name:"slug",type:"text",required:!0,value:s.slug,className:"w-full px-4 py-3 rounded-lg bg-[#2a2a2a] text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-white placeholder:text-gray-400"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-white text-sm mb-1",htmlFor:"parentCategoryId",children:"Valideyn Kateqoriya"}),e.jsxs("select",{id:"parentCategoryId",name:"parentCategoryId",onChange:a,value:s.parentCategoryId||"",className:"w-full px-4 py-3 rounded-lg bg-[#2a2a2a] text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-white",children:[e.jsx("option",{value:"",children:"Kök Kateqoriya"}),C?.filter(t=>t.id!==i?.id).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-white text-sm mb-1",htmlFor:"sortOrder",children:"Sıralama"}),e.jsx("input",{id:"sortOrder",name:"sortOrder",type:"number",onChange:a,value:s.sortOrder,className:"w-full px-4 py-3 rounded-lg bg-[#2a2a2a] text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-white"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isActive",name:"isActive",type:"checkbox",onChange:a,checked:s.isActive,className:"w-4 h-4 rounded border-gray-700 bg-[#2a2a2a] text-white focus:ring-2 focus:ring-white"}),e.jsx("label",{className:"text-white text-sm font-medium",htmlFor:"isActive",children:"Aktiv"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-white text-sm mb-2",children:"Kateqoriya şəkli"}),c&&e.jsx("div",{className:"relative mb-3 w-full h-40 rounded-lg overflow-hidden bg-[#2a2a2a] border border-gray-700",children:e.jsx("img",{src:r(),alt:"Preview",className:"w-full h-full object-cover"})}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",onChange:u,className:"flex items-center justify-center gap-2 px-4 py-3 bg-[#2a2a2a] text-white border border-gray-700 rounded-lg cursor-pointer hover:bg-[#333333] transition-colors"},"category-image-input"),e.jsx("p",{className:"text-gray-400 text-xs mt-2",children:"Accepted formats: JPG, PNG, GIF (Max 5MB)"})]}),g&&e.jsxs("div",{className:"text-xs text-gray-400 p-3 bg-[#2a2a2a] rounded border border-gray-700",children:[e.jsx("p",{className:"font-semibold text-white mb-1",children:"Debug Məlumatı:"}),e.jsxs("p",{children:["Seçilmiş fayl: ",g.name]}),e.jsxs("p",{children:["Ölçü: ",(g.size/1024).toFixed(2)," KB"]}),e.jsxs("p",{children:["Tip: ",g.type]}),e.jsxs("p",{children:["Yeni şəkil: ",y?"Bəli":"Xeyr"]}),e.jsxs("p",{children:["Önizləmə var: ",c?"Bəli":"Xeyr"]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>m&&m(),className:"px-6 py-3 bg-[#2a2a2a] text-white font-semibold rounded-lg hover:bg-[#333333] transition-all",children:"Ləğv et"}),e.jsx("button",{type:"submit",disabled:x,className:"px-6 py-3 bg-white text-black font-semibold rounded-lg hover:bg-gray-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Yadda saxlanılır..."})]}):"Dəyişiklikləri yadda saxla"})]})]})},H=()=>{const[i,m]=n.useState(null),[C,x]=n.useState(null),{data:d,isLoading:w,error:j,refetch:g}=L();console.log(d);const{data:o,isParCatLoading:c}=q();console.log(o);const[f,y]=n.useState({}),[h]=M(),s=n.useMemo(()=>{if(!d)return{};const a={};return d.forEach(r=>{const t=r.parentCategoryId||"root";a[t]||(a[t]=[]),a[t].push(r)}),a},[d]),v=async a=>{try{await h({id:a}).unwrap(),b.success("Kateqoriya uğurla silindi"),u()}catch(r){b.error(r?.data||"Kateqoriyanı silmək alınmadı")}},u=()=>{m(null),x(null),g()},N=a=>{const r=s[a.id]?.length>0,t=f[a.id];return e.jsxs("li",{className:"flex flex-col bg-[#1f1f1f] text-white rounded-xl shadow hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex justify-between items-center p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[r&&e.jsx("button",{onClick:()=>y(l=>({...l,[a.id]:!l[a.id]})),className:"text-gray-300 hover:text-white transition",children:t?e.jsx(E,{}):e.jsx(K,{})}),!r&&e.jsx("div",{className:"w-4"})," ",e.jsx("img",{className:"w-10 h-10 rounded-full",src:`${F}/${a.imageUrl}`||"https://static.nike.com/a/images/c_limit,w_592,f_auto/t_product_v1/u_126ab356-44d8-4a06-89b4-fcdcc8df0245,c_scale,fl_relative,w_1.0,h_1.0,fl_layer_apply/85d1d12f-b0a5-49c0-bc81-6238cfc5d9ac/JORDAN+1+RETRO+HIGH+OG+%28PS%29.png",alt:""}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium !text-white",children:a.name}),e.jsx("p",{className:"text-sm text-gray-400",children:a.slug||"slug"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{m("edit"),x(a)},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition",children:"Redaktə et"}),e.jsx("button",{onClick:()=>v(a.id),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition",children:"Sil"})]})]}),r&&t&&e.jsx("ul",{className:"ml-8 border-l border-gray-700 pl-4 space-y-2",children:s[a.id].map(l=>N(l))})]},a.id)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold !text-white",children:"Kateqoriyalar"}),e.jsx("button",{onClick:()=>m("add"),className:"px-6 py-3 font-semibold rounded-lg bg-white text-black hover:bg-gray-200 transition-all",children:"Yeni kateqoriya əlavə et"})]}),e.jsx(S,{open:i==="add",setOpen:u,children:e.jsx(R,{setOpen:u,categories:o})}),e.jsx(S,{open:i==="edit",setOpen:u,children:!w&&e.jsx(G,{setOpen:u,item:C,categories:d})}),e.jsx("ul",{className:"space-y-4",children:w?e.jsx(I,{className:"w-12 h-12 text-white animate-spin"}):s.root?.map(a=>N(a))})]})};export{H as default};
