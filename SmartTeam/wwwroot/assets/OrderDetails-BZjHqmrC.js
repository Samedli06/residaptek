import{q as M,ah as S,br as T,bs as A,bt as E,bu as I,r as c,j as e,L as O,c as D,Z as N,aj as w,y as d}from"./index-DLTHSUkz.js";import{A as F}from"./arrow-left-BAdYOKnR.js";import{F as v}from"./file-text-CLW6rUWD.js";import{S as R}from"./shopping-bag-B_vf7j0O.js";import{M as U}from"./minus-hiNAZL0r.js";import{P as $}from"./plus-P4biRvHf.js";import{T as Q}from"./trash-2-DKYwOl1C.js";import{C as q}from"./credit-card-Da5St12y.js";import{M as z,P as Z}from"./phone-DkCNFdCP.js";import{T as B}from"./truck-BdBIzDZO.js";import{C as G}from"./chevron-down-k6_Oy4Mn.js";import{f as H}from"./format-CSQe5d3I.js";const X=({currentStatus:l,currentStatusText:s,onStatusChange:g,isUpdating:p})=>{const[n,x]=c.useState(!1),m=c.useRef(null),h=[{value:0,label:"Gözləyir (Pending)",color:"bg-yellow-100 text-yellow-700"},{value:1,label:"Təsdiqləndi (Confirmed)",color:"bg-blue-100 text-blue-700"},{value:2,label:"Çatdırıldı (Delivered)",color:"bg-green-100 text-green-700"},{value:3,label:"Ləğv edildi (Cancelled)",color:"bg-red-100 text-red-700"}],o=h.find(r=>r.value===l)||h[0];return c.useEffect(()=>{const r=f=>{m.current&&!m.current.contains(f.target)&&x(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),e.jsxs("div",{className:"relative",ref:m,children:[e.jsxs("button",{onClick:()=>!p&&x(!n),className:`flex items-center justify-between gap-3 px-6 py-3 rounded-2xl font-bold border border-gray-800 transition-all min-w-[220px] shadow-lg ${o.color} ${p?"opacity-50 cursor-not-allowed":"hover:scale-[1.02] active:scale-[0.98]"}`,children:[e.jsx("span",{children:s||o.label}),e.jsx(G,{className:`transition-transform duration-300 ${n?"rotate-180":""} ${l===0?"text-yellow-700":l===1?"text-blue-700":l===2?"text-green-700":"text-red-700"}`,size:20})]}),n&&e.jsx("div",{className:"absolute top-full mt-3 right-0 w-full bg-[#1a1a1a] border border-gray-800 rounded-2xl shadow-2xl z-[100] overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",children:h.map(r=>e.jsxs("button",{onClick:()=>{g(r.value),x(!1)},className:`w-full text-left px-6 py-4 transition-colors flex items-center justify-between group ${r.value===l?"bg-white/5":"hover:bg-white/10"}`,children:[e.jsx("span",{className:`font-semibold ${r.value===l?"text-white":"text-gray-400 group-hover:text-white"}`,children:r.label}),e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${r.value===0?"bg-yellow-400":r.value===1?"bg-blue-400":r.value===2?"bg-green-400":(r.value===3,"bg-red-400")}`})]},r.value))})]})},de=()=>{const{id:l}=M(),{data:s,isLoading:g,isError:p,refetch:n}=S(l),[x,{isLoading:m}]=T(),[h,{isFetching:o}]=A(),[r]=E(),[f]=I(),u=c.useRef(null),b=c.useRef(null);c.useEffect(()=>{if(s&&b.current&&!u.current){const t=setTimeout(()=>{if(!b.current)return;const a=L.map(b.current).setView([s.latitude||40.4093,s.longitude||49.8671],15);u.current=a,L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(a),L.marker([s.latitude||40.4093,s.longitude||49.8671]).addTo(a),L.Control.geocoder().addTo(a),setTimeout(()=>a.invalidateSize(),100)},300);return()=>{clearTimeout(t),u.current&&(u.current.remove(),u.current=null)}}},[s]);const C=async t=>{try{await x({id:l,status:parseInt(t)}).unwrap(),d.success("Sifariş statusu yeniləndi"),n()}catch{d.error("Xəta baş verdi")}},k=async t=>{if(window.confirm("Bu məhsulu sifarişdən silmək istədiyinizə əminsiniz?"))try{await r({orderId:l,productId:t}).unwrap(),d.success("Məhsul silindi"),n()}catch{d.error("Xəta baş verdi")}},j=async(t,a,i)=>{const y=a+i;if(!(y<1))try{await f({orderId:l,productId:t,quantity:y}).unwrap(),d.success("Sayı yeniləndi"),n()}catch{d.error("Xəta baş verdi")}},P=async()=>{try{const t=await h(l).unwrap(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.setAttribute("download",`Order_${s.orderNumber}.pdf`),document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(a),d.success("PDF endirilir...")}catch(t){d.error("PDF export xətası"),console.error("PDF Export Error:",t)}};return g?e.jsx("div",{className:"flex items-center justify-center min-h-[400px] bg-[#111111]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):p||!s?e.jsx("div",{className:"p-8 text-center text-red-500 font-bold bg-[#111111] min-h-screen",children:"Sifariş tapılmadı"}):e.jsxs("div",{className:"p-6 bg-[#111111] min-h-screen pb-20 text-white",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(O,{to:"/admin/orders",className:"p-2 bg-[#1a1a1a] rounded-xl shadow-sm border border-gray-800 text-gray-400 hover:text-white transition-colors",children:e.jsx(F,{size:24})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold !text-white",children:["Sifariş #",s.orderNumber]}),e.jsx("p",{className:"text-gray-400 text-sm",children:H(new Date(s.createdAt),"dd MMMM yyyy, HH:mm")})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:P,disabled:o,className:`flex items-center gap-2 px-6 py-3 bg-red-600/10 text-red-500 border border-red-900/50 rounded-2xl font-bold hover:bg-red-600/20 transition-all ${o?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(v,{size:20}),o?"Hazırlanır...":"PDF Eksport"]}),e.jsx(X,{currentStatus:s.status,currentStatusText:s.statusText,onStatusChange:C,isUpdating:m})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs("div",{className:"bg-[#1a1a1a] rounded-3xl shadow-sm border border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex items-center gap-3",children:[e.jsx(R,{className:"text-white",size:20}),e.jsx("h2",{className:"text-lg font-bold !text-white",children:"Məhsullar"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-[#151515] text-xs font-semibold text-gray-400 uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Məhsul"}),e.jsx("th",{className:"px-6 py-4",children:"Qiymət"}),e.jsx("th",{className:"px-6 py-4",children:"Sayı"}),e.jsx("th",{className:"px-6 py-4",children:"Cəmi"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Fəaliyyət"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:s.items?.map((t,a)=>e.jsxs("tr",{className:"text-sm hover:bg-[#202020] transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:`${D}/${t.productImageUrl}`,alt:t.productName,className:"w-12 h-12 rounded-xl object-contain bg-[#252525] border border-gray-800",onError:i=>i.target.src="/Icons/logo.png"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white",children:t.productName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",t.productSku]})]})]})}),e.jsxs("td",{className:"px-6 py-4 text-gray-400",children:[t.unitPrice?.toFixed(2)," AZN"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center bg-[#252525] rounded-xl border border-gray-800 w-fit overflow-hidden",children:[e.jsx("button",{onClick:()=>j(t.productId,t.quantity,-1),className:"p-1 px-2 hover:bg-white/10 text-gray-400 hover:text-white transition-colors border-r border-gray-800",children:e.jsx(U,{size:14})}),e.jsx("span",{className:"px-3 font-bold text-white min-w-[30px] text-center",children:t.quantity}),e.jsx("button",{onClick:()=>j(t.productId,t.quantity,1),className:"p-1 px-2 hover:bg-white/10 text-gray-400 hover:text-white transition-colors border-l border-gray-800",children:e.jsx($,{size:14})})]})}),e.jsxs("td",{className:"px-6 py-4 font-bold text-white",children:[t.totalPrice?.toFixed(2)," AZN"]}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>k(t.productId),className:"p-2 text-red-500 hover:bg-red-500/10 rounded-xl transition-all",title:"Məhsulu sil",children:e.jsx(Q,{size:18})})})]},a))})]})}),e.jsx("div",{className:"p-6 bg-[#151515] border-t border-gray-800 mt-auto",children:e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("div",{className:"flex justify-between w-full md:w-80 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Məbləğ:"}),e.jsxs("span",{className:"font-semibold text-white",children:[s.subTotal?.toFixed(2)," AZN"]})]}),s.promoCodeDiscount>0&&e.jsxs("div",{className:"flex justify-between w-full md:w-80 text-sm text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{size:14})," Promo endirim:"]}),e.jsxs("span",{className:"font-semibold",children:["- ",s.promoCodeDiscount?.toFixed(2)," AZN"]})]}),s.walletDiscount>0&&e.jsxs("div",{className:"flex justify-between w-full md:w-80 text-sm text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{size:14})," Balans endirimi:"]}),e.jsxs("span",{className:"font-semibold",children:["- ",s.walletDiscount?.toFixed(2)," AZN"]})]}),e.jsxs("div",{className:"flex justify-between w-full md:w-80 pt-3 border-t border-gray-800",children:[e.jsx("span",{className:"text-lg font-bold !text-white",children:"Yekun:"}),e.jsxs("span",{className:"text-2xl font-black text-white",children:[s.totalAmount?.toFixed(2)," AZN"]})]})]})})]}),e.jsxs("div",{className:"bg-[#1a1a1a] rounded-3xl shadow-sm border border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex items-center gap-3",children:[e.jsx(z,{className:"text-white",size:20}),e.jsx("h2",{className:"text-lg font-bold !text-white",children:"Çatdırılma koordinatları"})]}),e.jsx("div",{ref:b,className:"w-full h-[400px] z-0"})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-[#1a1a1a] rounded-3xl shadow-sm border border-gray-800 p-6 space-y-6",children:[e.jsxs("h2",{className:"text-lg font-bold !text-white flex items-center gap-3",children:[e.jsx(w,{className:"text-white",size:20})," Müştəri məlumatları"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(w,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Ad, Soyad"}),e.jsx("p",{className:"font-bold text-white",children:s.customerName})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(N,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Aptek adı"}),e.jsx("p",{className:"font-bold text-white",children:s.pharmacyName||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(Z,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Telefon"}),e.jsx("p",{className:"font-bold text-white",children:s.customerPhone})]})]})]})]}),e.jsxs("div",{className:"bg-[#1a1a1a] rounded-3xl shadow-sm border border-gray-800 p-6 space-y-6",children:[e.jsxs("h2",{className:"text-lg font-bold !text-white flex items-center gap-3",children:[e.jsx(B,{className:"text-white",size:20})," Çatdırılma detalları"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(z,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Çatdırılma ünvanı"}),e.jsx("p",{className:"font-bold text-white",children:s.deliveryAddress})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(v,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Sifariş qeydləri"}),e.jsx("p",{className:"font-medium text-gray-300",children:s.deliveryNotes||"Qeyd yoxdur"})]})]})]})]})]})]})]})};export{de as default};
