const c={CART_KEY:"ecommerce_cart",getCart(){try{const t=localStorage.getItem(this.CART_KEY);return t?JSON.parse(t):{items:[],totalPriceBeforeDiscount:0,totalDiscount:0,totalAmount:0}}catch(t){return console.error("Error reading cart:",t),{items:[],totalPriceBeforeDiscount:0,totalDiscount:0,totalAmount:0}}},saveCart(t){try{t.totalPriceBeforeDiscount=t.totalPriceBeforeDiscount||0,t.totalDiscount=t.totalDiscount||0,t.totalAmount=t.totalAmount||0,localStorage.setItem(this.CART_KEY,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("cartUpdated",{detail:t}))}catch(e){console.error("Error saving cart:",e)}},generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})},getProductPrice(t){return t.discountedPrice&&t.discountedPrice>0?Number(t.discountedPrice):Number(t.price)||0},addItem(t,e=1){const r=this.getCart(),i=this.getProductPrice(t),o=Number(t.price)||i,n=o-i,a=r.items.findIndex(s=>s.productId===t.id);if(a>-1){const s=r.items[a];s.quantity+=e,s.totalPriceBeforeDiscount=o*s.quantity,s.totalPrice=i*s.quantity}else{const s={id:this.generateUUID(),cartId:this.generateUUID(),productId:t.id,productName:t.name,productSku:t.sku,productDescription:t.shortDescription||t.description||"",productImageUrl:t.primaryImageUrl||t.images?.[0]?.imageUrl||"",quantity:e,unitPrice:i,productDiscount:n,totalPriceBeforeDiscount:o*e,totalPrice:i*e,createdAt:new Date().toISOString()};r.items.push(s)}return this.updateCartTotals(r),window.dispatchEvent(new Event("cartAnimation")),r},removeItem(t){const e=this.getCart();return e.items=e.items.filter(r=>r.id!==t),this.updateCartTotals(e),e},updateQuantity(t,e){const r=this.getCart(),i=r.items.find(n=>n.id===t);if(!i)return console.warn(`Item with id ${t} not found`),r;if(e<=0)return this.removeItem(t);i.quantity=e;const o=i.unitPrice+(i.productDiscount||0);return i.totalPriceBeforeDiscount=o*e,i.totalPrice=i.unitPrice*e,this.updateCartTotals(r),r},clearCart(){const t={items:[],totalPriceBeforeDiscount:0,totalDiscount:0,totalAmount:0};localStorage.setItem(this.CART_KEY,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("cartUpdated",{detail:t}))},getItemCount(){return this.getCart().items.reduce((e,r)=>e+r.quantity,0)},updateCartTotals(t){const e=t.items.reduce((o,n)=>o+(n.totalPriceBeforeDiscount||0),0),r=t.items.reduce((o,n)=>o+(n.productDiscount||0)*(n.quantity||0),0),i=t.items.reduce((o,n)=>o+(n.totalPrice||0),0);t.totalPriceBeforeDiscount=isNaN(e)?0:e,t.totalDiscount=isNaN(r)?0:r,t.totalAmount=isNaN(i)?0:i,this.saveCart(t)}};export{c as C};
