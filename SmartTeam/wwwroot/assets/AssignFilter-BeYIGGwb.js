import{r,b6 as K,n as W,b7 as Y,b8 as ee,b9 as se,ba as te,j as e,bb as L,a3 as w,F as P,al as T,c as $,X as R,y as a}from"./index-DLTHSUkz.js";import{L as B}from"./loader-circle-BGmTCRFh.js";import{T as le}from"./trash-2-DKYwOl1C.js";import{C as re}from"./chevron-up-BbZMoPCn.js";import{C as ae}from"./chevron-down-k6_Oy4Mn.js";import{C as ie}from"./check-H4uu9SSU.js";import{S as ne}from"./save-CHNz9jol.js";const be=()=>{const[D,F]=r.useState(!1),[d,k]=r.useState("single"),[l,o]=r.useState([]),[i,b]=r.useState(""),[m,h]=r.useState(""),[u,y]=r.useState(""),[g,C]=r.useState(""),[S,M]=r.useState(!1),{data:j,isLoading:I,refetch:f}=K(),[A,O]=r.useState({products:!0,filters:!0}),{data:x,isLoading:ce}=W(),[E]=Y(),[z]=ee(),[U]=se(),[H]=te(),n=j?.filter(s=>s.name.toLowerCase().includes(g.toLowerCase())||s.sku.toLowerCase().includes(g.toLowerCase())),N=x?.find(s=>s.id===i)?.options||[],V=s=>{O(t=>({...t,[s]:!t[s]}))},X=()=>{F(!0),o([]),b(""),h(""),y("")},v=()=>{F(!1),o([]),b(""),h(""),y("")},G=s=>{o(t=>d==="single"?[s]:t.includes(s)?t.filter(c=>c!==s):[...t,s])},Q=()=>{l.length===n.length?o([]):o(n.map(s=>s.id))},Z=async()=>{if(!i||l.length===0){a.error("Zəhmət olmasa ən azı bir məhsul və bir filtr seçin");return}if(!m&&!u){a.error("Zəhmət olmasa filtr seçimi seçin və ya xüsusi dəyər daxil edin");return}M(!0);try{const s={filterId:i,filterOptionId:m||null,customValue:u||null};d==="single"||l.length===1?(await E({productId:l[0],...s}).unwrap(),a.success("Filtr uğurla təyin edildi!"),f()):(await z({productIds:l,...s}).unwrap(),a.success(`Filtr ${l.length} məhsula uğurla təyin edildi!`)),v()}catch(s){console.error("Assignment error:",s),a.error(s?.data?.message||"Filtrləri təyin etmək uğursuz oldu")}finally{M(!1)}},_=async(s,t)=>{try{await U({productId:s}).unwrap(),a.success("Bütün filtrlər uğurla silindi!"),f()}catch(c){console.error("Remove all filters error:",c),a.error(c?.data?.message||"Filtrləri silmək uğursuz oldu")}},q=async(s,t,c)=>{try{await H({productId:s,filterId:t}).unwrap(),a.success("Filtr uğurla silindi!"),f()}catch(p){console.error("Remove filter error:",p),a.error(p?.data?.message||"Filtrləri silmək uğursuz oldu")}},J=()=>l.length===0?"Məhsul seçilməyib":l.length===1?j.find(t=>t.id===l[0])?.name||"Naməlum məhsul":`${l.length} məhsul seçildi`;return e.jsx("div",{className:"min-h-screen bg-[#181818] text-white p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold !text-white mb-2",children:"Məhsul Filtrinin Təyinatı"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Filtrləri məhsullara tək-tək və ya toplu şəkildə təyin et"})]}),e.jsxs("button",{onClick:X,className:"px-6 py-3 bg-white cursor-pointer text-gray-900 font-semibold rounded-lg shadow-lg flex items-center gap-2 hover:bg-gray-100 transition-all duration-200",children:[e.jsx(L,{className:"w-5 h-5"}),"Filtrləri təyin et"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-600 rounded-lg",children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold !text-white",children:j?.length||0}),e.jsx("p",{className:"text-gray-400",children:"Ümumi məhsul sayı"})]})]})}),e.jsx("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-600 rounded-lg",children:e.jsx(P,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold !text-white",children:x?.length||0}),e.jsx("p",{className:"text-gray-400",children:"Mövcud filtrlər"})]})]})}),e.jsx("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-600 rounded-lg",children:e.jsx(L,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold !text-white",children:x?.reduce((s,t)=>s+(t.options?.length||0),0)||0}),e.jsx("p",{className:"text-gray-400",children:"Ümumi seçimlər"})]})]})})]}),e.jsx("div",{className:"bg-gray-800 rounded-xl shadow-lg border border-gray-700 mb-8",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold !text-white",children:"Məhsul Filtrinin Təyinatıs"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Məhsullarda axtar...",value:g,onChange:s=>C(s.target.value),className:"pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500"})]})})]}),I?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("th",{className:"text-left py-4 px-4 font-semibold text-gray-300",children:"Məhsul"}),e.jsx("th",{className:"text-left py-4 px-4 font-semibold text-gray-300",children:"Təyin olunmuş filtrlər"}),e.jsx("th",{className:"text-center py-4 px-4 font-semibold text-gray-300",children:"Əməliyyatlar"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:n?.map(s=>e.jsxs("tr",{className:"hover:bg-gray-750 transition-colors",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:`${$}/${s.primaryImageUrl}`,alt:s.name,className:"w-12 h-12 rounded-lg object-cover bg-gray-600",onError:t=>{t.target.src="/api/placeholder/48/48"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-400",children:["ID: ",s.id.substring(0,8),"..."]})]})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.filters&&s.filters.length>0?s.filters.map((t,c)=>e.jsxs("span",{className:"px-2 py-1 bg-blue-600 text-white rounded-full text-xs flex items-center gap-1 group",title:`${t.filterName}: ${t.value||t.optionName}`,children:[t.filterOptionDisplayName,t.value&&e.jsxs("span",{className:"text-blue-200",children:[": ",t.value]}),e.jsx("button",{onClick:p=>{p.stopPropagation(),q(s.id,t.filterId,t.filterName)},className:"ml-1 hover:bg-blue-700 cursor-pointer rounded-full p-0.5 transition-colors",title:"Bu filtri sil",children:e.jsx(R,{className:"w-3 h-3 cursor-pointer"})})]},c)):e.jsx("span",{className:"text-gray-500 text-sm italic",children:"Filtr təyin olunmayıb"})})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:s.filters&&s.filters.length>0&&e.jsxs("button",{onClick:()=>_(s.id,s.name),className:"px-3 py-1 bg-red-600 whitespace-nowrap cursor-pointer hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-1",title:"Bütün filtrləri sil",children:[e.jsx(le,{className:"w-3 h-3"}),"Hamısını sil"]})})})]},s.id))})]}),(!n||n.length===0)&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"w-12 h-12 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Məhsul tapılmadı"})]})]})]})}),D&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-md bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-gray-800 rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold !text-white",children:"Filtrləri məhsullara təyin et"}),e.jsx("button",{onClick:v,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(R,{className:"w-5 h-5 text-gray-400 cursor-pointer"})})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex gap-2 p-1 bg-gray-700 rounded-lg w-fit",children:[e.jsx("button",{onClick:()=>k("single"),className:`px-4 py-2 rounded-md cursor-pointer font-medium transition-colors ${d==="single"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Tək məhsul"}),e.jsx("button",{onClick:()=>k("bulk"),className:`px-4 py-2 rounded-md cursor-pointer font-medium transition-colors ${d==="bulk"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Toplu təyinat"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold !text-white flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Məhsulları seç"]}),e.jsx("button",{onClick:()=>V("products"),className:"p-1 hover:bg-gray-700 rounded transition-colors",children:A.products?e.jsx(re,{className:"w-4 h-4 text-gray-400"}):e.jsx(ae,{className:"w-4 h-4 text-gray-400"})})]}),A.products&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Məhsullarda axtar...",value:g,onChange:s=>C(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500"})]}),d==="bulk"&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-700 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-gray-300",children:[l.length," / ",n?.length||0," seçildi"]}),e.jsx("button",{onClick:Q,className:"text-blue-400 hover:text-blue-300 text-sm font-medium",children:l.length===n?.length?"Hamısının seçimini ləğv et":"Hamısını seç"})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:n?.map(s=>e.jsxs("div",{onClick:()=>G(s.id),className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${l.includes(s.id)?"bg-blue-600 border-blue-500 text-white":"bg-gray-700 border-gray-600 hover:bg-gray-600"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-4",children:l.includes(s.id)&&e.jsx(ie,{className:"w-4 h-4 text-white"})}),e.jsx("img",{src:`${$}/${s.primaryImageUrl}`,alt:s.name,className:"w-10 h-10 rounded-lg object-cover bg-gray-600",onError:t=>{t.target.src="/api/placeholder/40/40"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsx("p",{className:"text-sm text-gray-400",children:s.sku||"N/A"})]}),e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-600 rounded text-gray-300",children:s.categoryName||"N/A"})]},s.id))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-lg font-semibold !text-white flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Filtr və seçim seç"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Filtr"}),e.jsxs("select",{value:i,onChange:s=>{b(s.target.value),h("")},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Filtr seçin"}),x?.filter(s=>s.isActive).map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.typeName||s.type,")"]},s.id))]})]}),i&&N.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Filtr seçimi"}),e.jsxs("select",{value:m,onChange:s=>h(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Seçim seçin"}),N.filter(s=>s.isActive).map(s=>e.jsxs("option",{value:s.id,children:[s.displayName||s.label," (",s.value,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Xüsusi dəyər (ixtiyari)"}),e.jsx("input",{type:"text",value:u,onChange:s=>y(s.target.value),placeholder:"Xüsusi dəyər daxil edin...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Seçilmiş filtr seçimini istifadə etmək üçün boş buraxın"})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 border border-gray-600",children:[e.jsx("h4",{className:"text-sm font-medium !text-white mb-2",children:"Təyinat xülasəsi"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"text-white",children:[e.jsx("span",{className:"text-gray-400",children:"Məhsullar:"})," ",J()]}),e.jsxs("p",{className:"text-white",children:[e.jsx("span",{className:"text-gray-400",children:"Filtr:"})," ",i?x?.find(s=>s.id===i)?.name||"Naməlum":"Seçilməyib"]}),e.jsxs("p",{className:"text-white",children:[e.jsx("span",{className:"text-gray-400",children:"Dəyər:"})," ",u||(m?N.find(s=>s.id===m)?.displayName||"Naməlum":"Təyin edilməyib")]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 mt-6 border-t border-gray-600",children:[e.jsx("button",{onClick:v,className:"px-6 py-3 bg-gray-600 text-white cursor-pointer rounded-lg hover:bg-gray-700 font-semibold transition-colors",children:"Ləğv et"}),e.jsxs("button",{onClick:Z,disabled:S||!i||l.length===0,className:"px-6 py-3 bg-blue-600 text-white cursor-pointer rounded-lg hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center gap-2 font-semibold transition-colors",children:[S&&e.jsx(B,{className:"w-4 h-4 animate-spin"}),e.jsx(ne,{className:"w-4 h-4"}),d==="single"?"Filtrləri təyin et":`${l.length} məhsula təyin et`]})]})]})})})]})})};export{be as default};
