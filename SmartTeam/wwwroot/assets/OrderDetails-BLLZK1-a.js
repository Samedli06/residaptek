import{q as v,ah as w,bp as z,bq as C,r as o,j as e,L as P,c as k,Z as b,aj as f,y as p}from"./index-DXStjdCc.js";import{A as S}from"./arrow-left-CZlfukew.js";import{F as j}from"./file-text-BhHmwouq.js";import{S as A}from"./shopping-bag-Stk4Wgbj.js";import{C as E}from"./credit-card-BVh5Q-ta.js";import{M as N,P as T}from"./phone--m5n9_sT.js";import{T as D}from"./truck-CFWlfweT.js";import{C as F}from"./chevron-down-B4kPK6ik.js";import{f as M}from"./format-CSQe5d3I.js";const O=({currentStatus:l,currentStatusText:s,onStatusChange:u,isUpdating:h})=>{const[c,x]=o.useState(!1),m=o.useRef(null),i=[{value:0,label:"Gözləyir (Pending)",color:"bg-yellow-100 text-yellow-700"},{value:1,label:"Təsdiqləndi (Confirmed)",color:"bg-blue-100 text-blue-700"},{value:2,label:"Çatdırıldı (Delivered)",color:"bg-green-100 text-green-700"},{value:3,label:"Ləğv edildi (Cancelled)",color:"bg-red-100 text-red-700"}],d=i.find(t=>t.value===l)||i[0];return o.useEffect(()=>{const t=g=>{m.current&&!m.current.contains(g.target)&&x(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),e.jsxs("div",{className:"relative",ref:m,children:[e.jsxs("button",{onClick:()=>!h&&x(!c),className:`flex items-center justify-between gap-3 px-6 py-3 rounded-2xl font-bold border border-gray-800 transition-all min-w-[220px] shadow-lg ${d.color} ${h?"opacity-50 cursor-not-allowed":"hover:scale-[1.02] active:scale-[0.98]"}`,children:[e.jsx("span",{children:s||d.label}),e.jsx(F,{className:`transition-transform duration-300 ${c?"rotate-180":""} ${l===0?"text-yellow-700":l===1?"text-blue-700":l===2?"text-green-700":"text-red-700"}`,size:20})]}),c&&e.jsx("div",{className:"absolute top-full mt-3 right-0 w-full bg-[#1a1a1a] border border-gray-800 rounded-2xl shadow-2xl z-[100] overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",children:i.map(t=>e.jsxs("button",{onClick:()=>{u(t.value),x(!1)},className:`w-full text-left px-6 py-4 transition-colors flex items-center justify-between group ${t.value===l?"bg-white/5":"hover:bg-white/10"}`,children:[e.jsx("span",{className:`font-semibold ${t.value===l?"text-white":"text-gray-400 group-hover:text-white"}`,children:t.label}),e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${t.value===0?"bg-yellow-400":t.value===1?"bg-blue-400":t.value===2?"bg-green-400":"bg-red-400"}`})]},t.value))})]})},H=()=>{const{id:l}=v(),{data:s,isLoading:u,isError:h}=w(l),[c,{isLoading:x}]=z(),[m,{isFetching:i}]=C(),d=o.useRef(null),t=o.useRef(null);o.useEffect(()=>{if(s&&t.current&&!d.current){const r=setTimeout(()=>{if(!t.current)return;const a=L.map(t.current).setView([s.latitude||40.4093,s.longitude||49.8671],15);d.current=a,L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(a),L.marker([s.latitude||40.4093,s.longitude||49.8671]).addTo(a),L.Control.geocoder().addTo(a),setTimeout(()=>a.invalidateSize(),100)},300);return()=>{clearTimeout(r),d.current&&(d.current.remove(),d.current=null)}}},[s]);const g=async r=>{try{await c({id:l,status:parseInt(r)}).unwrap(),p.success("Sifariş statusu yeniləndi")}catch{p.error("Xəta baş verdi")}},y=async()=>{try{const r=await m(l).unwrap(),a=window.URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.setAttribute("download",`Order_${s.orderNumber}.pdf`),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(a),p.success("PDF endirilir...")}catch(r){p.error("PDF export xətası"),console.error("PDF Export Error:",r)}};return u?e.jsx("div",{className:"flex items-center justify-center min-h-[400px] bg-[#111111]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"})}):h||!s?e.jsx("div",{className:"p-8 text-center text-red-500 font-bold bg-[#111111] min-h-screen",children:"Sifariş tapılmadı"}):e.jsxs("div",{className:"p-6 bg-[#111111] min-h-screen pb-20 text-white",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{to:"/admin/orders",className:"p-2 bg-[#1a1a1a] rounded-xl shadow-sm border border-gray-800 text-gray-400 hover:text-white transition-colors",children:e.jsx(S,{size:24})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold !text-white",children:["Sifariş #",s.orderNumber]}),e.jsx("p",{className:"text-gray-400 text-sm",children:M(new Date(s.createdAt),"dd MMMM yyyy, HH:mm")})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:y,disabled:i,className:`flex items-center gap-2 px-6 py-3 bg-red-600/10 text-red-500 border border-red-900/50 rounded-2xl font-bold hover:bg-red-600/20 transition-all ${i?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(j,{size:20}),i?"Hazırlanır...":"PDF Eksport"]}),e.jsx(O,{currentStatus:s.status,currentStatusText:s.statusText,onStatusChange:g,isUpdating:x})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs("div",{className:"bg-[#1a1a1a] rounded-3xl shadow-sm border border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex items-center gap-3",children:[e.jsx(A,{className:"text-white",size:20}),e.jsx("h2",{className:"text-lg font-bold !text-white",children:"Məhsullar"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-[#151515] text-xs font-semibold text-gray-400 uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Məhsul"}),e.jsx("th",{className:"px-6 py-4",children:"Qiymət"}),e.jsx("th",{className:"px-6 py-4",children:"Sayı"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Cəmi"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:s.items?.map((r,a)=>e.jsxs("tr",{className:"text-sm hover:bg-[#202020] transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 flex items-center gap-4",children:[e.jsx("img",{src:`${k}/${r.productImageUrl}`,alt:r.productName,className:"w-12 h-12 rounded-xl object-contain bg-[#252525] border border-gray-800",onError:n=>n.target.src="/Icons/logo.png"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white",children:r.productName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",r.productSku]})]})]}),e.jsxs("td",{className:"px-6 py-4 text-gray-400",children:[r.unitPrice?.toFixed(2)," AZN"]}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-300",children:r.quantity}),e.jsxs("td",{className:"px-6 py-4 text-right font-bold text-white",children:[r.totalPrice?.toFixed(2)," AZN"]})]},a))})]})}),e.jsx("div",{className:"p-6 bg-[#151515] border-t border-gray-800 mt-auto",children:e.jsxs("div",{className:"flex flex-col items-end gap-3",children:[e.jsxs("div",{className:"flex justify-between w-full md:w-80 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Məbləğ:"}),e.jsxs("span",{className:"font-semibold text-white",children:[s.subTotal?.toFixed(2)," AZN"]})]}),s.promoCodeDiscount>0&&e.jsxs("div",{className:"flex justify-between w-full md:w-80 text-sm text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{size:14})," Promo endirim:"]}),e.jsxs("span",{className:"font-semibold",children:["- ",s.promoCodeDiscount?.toFixed(2)," AZN"]})]}),s.walletDiscount>0&&e.jsxs("div",{className:"flex justify-between w-full md:w-80 text-sm text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(E,{size:14})," Balans endirimi:"]}),e.jsxs("span",{className:"font-semibold",children:["- ",s.walletDiscount?.toFixed(2)," AZN"]})]}),e.jsxs("div",{className:"flex justify-between w-full md:w-80 pt-3 border-t border-gray-800",children:[e.jsx("span",{className:"text-lg font-bold !text-white",children:"Yekun:"}),e.jsxs("span",{className:"text-2xl font-black text-white",children:[s.totalAmount?.toFixed(2)," AZN"]})]})]})})]}),e.jsxs("div",{className:"bg-[#1a1a1a] rounded-3xl shadow-sm border border-gray-800 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-800 flex items-center gap-3",children:[e.jsx(N,{className:"text-white",size:20}),e.jsx("h2",{className:"text-lg font-bold !text-white",children:"Çatdırılma koordinatları"})]}),e.jsx("div",{ref:t,className:"w-full h-[400px] z-0"})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-[#1a1a1a] rounded-3xl shadow-sm border border-gray-800 p-6 space-y-6",children:[e.jsxs("h2",{className:"text-lg font-bold !text-white flex items-center gap-3",children:[e.jsx(f,{className:"text-white",size:20})," Müştəri məlumatları"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(f,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Ad, Soyad"}),e.jsx("p",{className:"font-bold text-white",children:s.customerName})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(b,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Aptek adı"}),e.jsx("p",{className:"font-bold text-white",children:s.pharmacyName||"-"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(T,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Telefon"}),e.jsx("p",{className:"font-bold text-white",children:s.customerPhone})]})]})]})]}),e.jsxs("div",{className:"bg-[#1a1a1a] rounded-3xl shadow-sm border border-gray-800 p-6 space-y-6",children:[e.jsxs("h2",{className:"text-lg font-bold !text-white flex items-center gap-3",children:[e.jsx(D,{className:"text-white",size:20})," Çatdırılma detalları"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(N,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Çatdırılma ünvanı"}),e.jsx("p",{className:"font-bold text-white",children:s.deliveryAddress})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-[#252525] rounded-2xl",children:e.jsx(j,{size:18,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Sifariş qeydləri"}),e.jsx("p",{className:"font-medium text-gray-300",children:s.deliveryNotes||"Qeyd yoxdur"})]})]})]})]})]})]})]})};export{H as default};
